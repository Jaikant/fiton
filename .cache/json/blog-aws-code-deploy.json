{"data":{"allContentfulBlogPost":{"edges":[{"node":{"id":"c3zDfdcnBqEqKqmMoYcumQI","title":"Configuring AWS Code Deploy ","tags":["CLOUD"],"description":{"id":"c3zDfdcnBqEqKqmMoYcumQIdescriptionTextNode","description":"Steps for configuring AWS CODE deploy."},"createdAt":"2018-02-22T06:08:09.219Z","blog":{"childMarkdownRemark":{"html":"<p>Here I describe how we could use AWS Code deploy to transfer your code to an EC2 server for deployment. AWS code deploy can be used for much more, but that is not the topic of this blog.</p>\n<p>If you have a single server (and not a cluster) you could do a much simpler deployment by using SSH and shell scripts.</p>\n<p>For AWS Code deploy to transfer the code to your production or staging server. You need to do the following</p>\n<h2 id=\"aws-code-deploy-setup\"><a href=\"#aws-code-deploy-setup\" aria-hidden=\"true\" class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>AWS Code Deploy Setup</h2>\n<ol>\n<li>EC2 instance should have an IAM profile which allows it to access S3.\nFor a new EC2 instance which has to be launched, follow the steps in this <a href=\"https://docs.aws.amazon.com/codedeploy/latest/userguide/getting-started-create-iam-instance-profile.html\">link</a>\nFor an existing EC2 instance, run the below command:</li>\n</ol>\n<div class=\"gatsby-highlight\">\n      <pre class=\"language-sh\"><code class=\"language-sh\">aws ec2 associate-iam-instance-profile --instance-id i-xyzabcdef --iam-instance-profile Name=Myapp-Instance-Profile\n\naws ec2 describe-iam-instance-profile-associations</code></pre>\n      </div>\n<p>The above is described in more detail in this <a href=\"https://aws.amazon.com/blogs/security/new-attach-an-aws-iam-role-to-an-existing-amazon-ec2-instance-by-using-the-aws-cli/\">link</a></p>\n<ol start=\"2\">\n<li>The EC2 instance should have the AWS code deploy agent running, you can get running by doing the following on a unix server. This downloads the code deploy from the ap-south-1 region. </li>\n</ol>\n<div class=\"gatsby-highlight\">\n      <pre class=\"language-sh\"><code class=\"language-sh\">wget https://aws-codedeploy-ap-south-1.s3.amazonaws.com/latest/install\nchmod +x ./install\nsudo ./install auto\nNow check status:\nsudo service codedeploy-agent status</code></pre>\n      </div>\n<p>The above steps are further described in this <a href=\"https://docs.aws.amazon.com/codedeploy/latest/userguide/codedeploy-agent-operations-install-linux.html\">link</a>.</p>\n<ol start=\"3\">\n<li>An AWS Code deploy APP would need to be created. You will need to create a deployment group within the app. The deployment group will reference the ec2 instance above. This should be straightforward.</li>\n</ol>\n<ol start=\"4\">\n<li>You would need to create a policy which allows code deploy to access s3.</li>\n</ol>\n<div class=\"gatsby-highlight\">\n      <pre class=\"language-sh\"><code class=\"language-sh\">{\n  &quot;Version&quot;: &quot;2012-10-17&quot;,\n  &quot;Statement&quot;: [\n    {\n      &quot;Effect&quot;: &quot;Allow&quot;,\n      &quot;Action&quot;: [&quot;s3:ListAllMyBuckets&quot;,&quot;s3:PutObject&quot;],\n      &quot;Resource&quot;: &quot;arn:aws:s3:::*&quot;\n    },\n   {\n     &quot;Effect&quot;: &quot;Allow&quot;,\n     &quot;Action&quot;: [&quot;codedeploy:*&quot;],&quot;Resource&quot;: &quot;*&quot;\n   }\n ]\n}</code></pre>\n      </div>\n<h2 id=\"setup-on-your-code-structure\"><a href=\"#setup-on-your-code-structure\" aria-hidden=\"true\" class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Setup on your code structure</h2>\n<p>On your code structure, you would need to create an appspec.yml file which could contain commands which you need to execute on deployment.</p>\n<p>An appspec yaml file is as simple as shown below, this tells AWS code deploy to run the <code class=\"language-text\">installCode.sh</code> shell script for Application Start. Like the <code class=\"language-text\">ApplicationStart</code> tag below, there are other life cycle hooks available.</p>\n<div class=\"gatsby-highlight\">\n      <pre class=\"language-sh\"><code class=\"language-sh\">version: 0.0\nos: linux\nfiles:\n  - source: /\n    destination: /home/ec2-user/build\nhooks:\n  ApplicationStart:\n    - location: installCode.sh\n      timeout: 300\n      runas: root</code></pre>\n      </div>\n<p>A Sample appspec.yml file, can be found in this <a href=\"https://docs.aws.amazon.com/codedeploy/latest/userguide/reference-appspec-file.html#appspec-reference-server\">link</a></p>\n<p>Thats about it, for the setup. To push code to your EC2 instance you would have to run the below commands. [Assuming you have the aws cli and keys installed on your system]</p>\n<div class=\"gatsby-highlight\">\n      <pre class=\"language-sh\"><code class=\"language-sh\">$ aws deploy push --application-name &lt;application-name&gt; --s3-location s3://&lt;bucket name&gt;/&lt;any build name&gt; --source &lt;directory&gt;\n\n$ aws deploy create-deployment --application-name &lt;application-name&gt; --s3-location bucket=&lt;bucket-name&gt;,key=&lt;any build name&gt;,bundleType=zip,eTag=&lt;tag from deploy command&gt; --deployment-group-name &lt;deployment group name&gt;</code></pre>\n      </div>\n<p>Hope this was useful. You could write to me at jaikant@gmail.com</p>","timeToRead":3}},"featuredImage":{"title":"AWS Code Deploy","resize":{"src":"//images.ctfassets.net/ojam5vx77jn8/1rxl05X29KUYYawGA8AKQY/ff9c5fa57f39d1d9b6775c56b270a920/aws-codedeploy.png?w=1200&h=630&fl=progressive&q=50&fit=fill&f=faces"},"sizes":{"aspectRatio":1,"src":"//images.ctfassets.net/ojam5vx77jn8/1rxl05X29KUYYawGA8AKQY/ff9c5fa57f39d1d9b6775c56b270a920/aws-codedeploy.png?w=800&q=50","srcSet":"//images.ctfassets.net/ojam5vx77jn8/1rxl05X29KUYYawGA8AKQY/ff9c5fa57f39d1d9b6775c56b270a920/aws-codedeploy.png?w=200&h=200&q=50 200w,\n//images.ctfassets.net/ojam5vx77jn8/1rxl05X29KUYYawGA8AKQY/ff9c5fa57f39d1d9b6775c56b270a920/aws-codedeploy.png?w=400&h=400&q=50 400w,\n//images.ctfassets.net/ojam5vx77jn8/1rxl05X29KUYYawGA8AKQY/ff9c5fa57f39d1d9b6775c56b270a920/aws-codedeploy.png?w=800&h=800&q=50 800w,\n//images.ctfassets.net/ojam5vx77jn8/1rxl05X29KUYYawGA8AKQY/ff9c5fa57f39d1d9b6775c56b270a920/aws-codedeploy.png?w=1200&h=1200&q=50 1200w,\n//images.ctfassets.net/ojam5vx77jn8/1rxl05X29KUYYawGA8AKQY/ff9c5fa57f39d1d9b6775c56b270a920/aws-codedeploy.png?w=1292&h=1292&q=50 1292w","sizes":"(max-width: 800px) 100vw, 800px"}},"author":{"name":"Jai","authorBio":"Jai is passionate about social issues and causes. He is the founder of sherpafeet and Tech47.","profilePicture":{"title":"Jai Profile Picture","resolutions":{"base64":"data:image/jpeg;base64,/9j/4AAQSkZJRgABAQEAlgCWAAD/4gIcSUNDX1BST0ZJTEUAAQEAAAIMbGNtcwIQAABtbnRyUkdCIFhZWiAH3AABABkAAwApADlhY3NwQVBQTAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA9tYAAQAAAADTLWxjbXMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAApkZXNjAAAA/AAAAF5jcHJ0AAABXAAAAAt3dHB0AAABaAAAABRia3B0AAABfAAAABRyWFlaAAABkAAAABRnWFlaAAABpAAAABRiWFlaAAABuAAAABRyVFJDAAABzAAAAEBnVFJDAAABzAAAAEBiVFJDAAABzAAAAEBkZXNjAAAAAAAAAANjMgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB0ZXh0AAAAAEZCAABYWVogAAAAAAAA9tYAAQAAAADTLVhZWiAAAAAAAAADFgAAAzMAAAKkWFlaIAAAAAAAAG+iAAA49QAAA5BYWVogAAAAAAAAYpkAALeFAAAY2lhZWiAAAAAAAAAkoAAAD4QAALbPY3VydgAAAAAAAAAaAAAAywHJA2MFkghrC/YQPxVRGzQh8SmQMhg7kkYFUXdd7WtwegWJsZp8rGm/fdPD6TD////bAEMACQYHCAcGCQgICAoKCQsOFw8ODQ0OHBQVERciHiMjIR4gICUqNS0lJzIoICAuPy8yNzk8PDwkLUJGQTpGNTs8Of/bAEMBCgoKDgwOGw8PGzkmICY5OTk5OTk5OTk5OTk5OTk5OTk5OTk5OTk5OTk5OTk5OTk5OTk5OTk5OTk5OTk5OTk5Of/AABEIABQAFAMBIgACEQEDEQH/xAAZAAEAAwEBAAAAAAAAAAAAAAAAAgYHBAX/xAAoEAACAQMBBwQDAAAAAAAAAAABAgMABBEhBQYSIjFBgQcTUXEVYaH/xAAXAQADAQAAAAAAAAAAAAAAAAACAwQB/8QAGREBAQADAQAAAAAAAAAAAAAAAQACERIx/9oADAMBAAIRAxEAPwCvrf7TlmuQkcIjgdl5gTx4Pb+V7Fw8dtbPPIRgDpkYqG7ca7QiM0ygSxnTm1mxrk9j2HjWq7vLtC4mihZoAqhmSTBzwPnpjxp5qbT0jUbx5ErDs31HtLGyS3EMoKs5OY1bJLE9SfggeKVl84aOQqCT36YpTuCSto27cCR7JW6QFZQ7N1PYkAfWldDhPxctz7cfuvPwk8I+M5+/3SlFgG23JdFGGCIRjkU/YpSlLfYi/9k=","width":125,"height":125,"src":"//images.ctfassets.net/ojam5vx77jn8/48JEu6lPigqI46gmeyuysC/4bbc705827749cebe670959385fb7cc2/jai.jpeg?w=125&q=50","srcSet":"//images.ctfassets.net/ojam5vx77jn8/48JEu6lPigqI46gmeyuysC/4bbc705827749cebe670959385fb7cc2/jai.jpeg?w=125&h=125&q=50 1x,\n//images.ctfassets.net/ojam5vx77jn8/48JEu6lPigqI46gmeyuysC/4bbc705827749cebe670959385fb7cc2/jai.jpeg?w=188&h=188&q=50 1.5x,\n//images.ctfassets.net/ojam5vx77jn8/48JEu6lPigqI46gmeyuysC/4bbc705827749cebe670959385fb7cc2/jai.jpeg?w=250&h=250&q=50 2x,\n//images.ctfassets.net/ojam5vx77jn8/48JEu6lPigqI46gmeyuysC/4bbc705827749cebe670959385fb7cc2/jai.jpeg?w=375&h=375&q=50 3x"}}}}}]}},"pathContext":{"slug":"/blog/aws-code-deploy","prev":{"id":"c5ZU6XxdyMwwEkKqIigGYwe","featured":null,"title":"Technology For Social Good","tags":["WEBSITES"],"slug":"/blog/social-good","createdAt":"2017-12-28T04:30:28.763Z","updatedAt":"April 19 2018","description":{"id":"c5ZU6XxdyMwwEkKqIigGYwedescriptionTextNode"},"blog":{"childMarkdownRemark":{"timeToRead":1,"excerpt":"Technology is a great enabler and we feel everyone has a right to use the best technology. If you are a social enterprise or NGO, we can help you with technology. How we can help Social Enterprises If…"}},"featuredImage":{"title":"Children on cycle","resolutions":{"width":350,"height":175,"src":"//images.ctfassets.net/ojam5vx77jn8/QUKmNCdT8qg2SOyMOwKGe/31b1e311600c8e4258d2eb1931432b73/children-cycle.jpg?w=350&h=175&q=50&fit=fill&f=faces","srcSet":"//images.ctfassets.net/ojam5vx77jn8/QUKmNCdT8qg2SOyMOwKGe/31b1e311600c8e4258d2eb1931432b73/children-cycle.jpg?w=350&h=175&q=50&fit=fill&f=faces 1x,\n//images.ctfassets.net/ojam5vx77jn8/QUKmNCdT8qg2SOyMOwKGe/31b1e311600c8e4258d2eb1931432b73/children-cycle.jpg?w=525&h=263&q=50&fit=fill&f=faces 1.5x,\n//images.ctfassets.net/ojam5vx77jn8/QUKmNCdT8qg2SOyMOwKGe/31b1e311600c8e4258d2eb1931432b73/children-cycle.jpg?w=700&h=350&q=50&fit=fill&f=faces 2x,\n//images.ctfassets.net/ojam5vx77jn8/QUKmNCdT8qg2SOyMOwKGe/31b1e311600c8e4258d2eb1931432b73/children-cycle.jpg?w=1050&h=525&q=50&fit=fill&f=faces 3x"}}},"next":{"id":"ryzymF42OGcuGmS2q8sw4","featured":null,"title":"A step by step guide to build a Gatsbyjs blog","tags":["SERVERLESS"],"slug":"/blog/build-blog-gatsbyjs","createdAt":"2018-02-06T15:16:35.160Z","updatedAt":"April 19 2018","description":{"id":"ryzymF42OGcuGmS2q8sw4descriptionTextNode"},"blog":{"childMarkdownRemark":{"timeToRead":7,"excerpt":"In this post we will create a barebone blogging website from scratch using GatsbyJs.  The purpose being to learn a few basic concepts of Gatsbyjs. Blogs will be in markdown format and will reside in…"}},"featuredImage":{"title":"Leonardo Di Caprio in the great gatsby","resolutions":{"width":350,"height":175,"src":"//images.ctfassets.net/ojam5vx77jn8/3QDJUfMpHqMGm0W0A6066y/8690f8e8228c0562bc89fdf018d7386c/gatsby.jpg?w=350&h=175&q=50&fit=fill&f=faces","srcSet":"//images.ctfassets.net/ojam5vx77jn8/3QDJUfMpHqMGm0W0A6066y/8690f8e8228c0562bc89fdf018d7386c/gatsby.jpg?w=350&h=175&q=50&fit=fill&f=faces 1x,\n//images.ctfassets.net/ojam5vx77jn8/3QDJUfMpHqMGm0W0A6066y/8690f8e8228c0562bc89fdf018d7386c/gatsby.jpg?w=525&h=263&q=50&fit=fill&f=faces 1.5x,\n//images.ctfassets.net/ojam5vx77jn8/3QDJUfMpHqMGm0W0A6066y/8690f8e8228c0562bc89fdf018d7386c/gatsby.jpg?w=700&h=350&q=50&fit=fill&f=faces 2x,\n//images.ctfassets.net/ojam5vx77jn8/3QDJUfMpHqMGm0W0A6066y/8690f8e8228c0562bc89fdf018d7386c/gatsby.jpg?w=1050&h=525&q=50&fit=fill&f=faces 3x"}}}}}